$id: https://schemas.ceeconnect.fr/bundles/precarite
$schema: 'https://json-schema.org/draft/2020-12/schema'
title: Précarité énergétique
description: Prise en compte de la précarité énergétique du bénéficiaire
type: object
properties:
  scenario:
    $ref: https://schemas.ceeconnect.fr/enums/scenario_precarite
required:
  - scenario
anyOf:
  - $ref: '#/$defs/8.1'
  - $ref: '#/$defs/8.2'
  - $ref: '#/$defs/8.3'
  - $ref: '#/$defs/8.4'
  - $ref: '#/$defs/8.5'
$defs:
  '8.1':
    type: object
    allOf:
      - properties:
          scenario:
            $ref: https://schemas.ceeconnect.fr/enums/scenario_precarite#/$defs/8.1
        required:
          - scenario
      - properties:
          categorieRessource:
            $ref: https://schemas.ceeconnect.fr/enums/categorie_ressource
        required:
          - categorieRessource
        allOf:
          - $ref: '#/$defs/menage'
  '8.2':
    type: object
    allOf:
      - properties:
          scenario:
            $ref: https://schemas.ceeconnect.fr/enums/scenario_precarite#/$defs/8.2
        required:
          - scenario
      - properties:
          bailleursSociaux:
            title: Liste des bailleurs sociaux
            type: array
            minItems: 1
            items:
              $ref: '#/$defs/bailleurSocial'
          menages:
            title: Liste des ménages
            description: Ménages occupants un logement qui n'est pas géré par l'un des bailleurs sociaux renseignés
            type: array
            minItems: 1
            items:
              $ref: '#/$defs/menage'
        required:
          - bailleursSociaux
          - menages
  '8.3':
    type: object
    allOf:
      - properties:
          scenario:
            $ref: https://schemas.ceeconnect.fr/enums/scenario_precarite#/$defs/8.3
        required:
          - scenario
      - properties:
          nombreMenages:
            title: Nombre de ménages
            description: Indiquer le nombre de ménages concernés par l'opération
            type: integer
            minimum: 1
          nombreMenagesModestes:
            title: Nombre de ménages modestes
            description: |
              Indiquer le nombre de ménages concernés par l'opération dont les ressources sont inférieures au plafond des 
              catégories "Modeste" et "Très modestes" du barème Ma Prime Rénov'
            type: integer
            minimum: 0
          nombreMenagesTresModestes:
            title: Nombre de ménages précaires
            description: |
              Indiquer le nombre de ménages concernés par l'opération dont les ressources sont inférieures au plafond de 
              catégorie "Très modestes" du barème Ma Prime Rénov'
            type: integer
            minimum: 0
        required:
          - nombreMenages
          - nombreMenagesModestes
          - nombreMenagesTresModestes
  '8.4':
    type: object
    allOf:
      - properties:
          scenario:
            $ref: https://schemas.ceeconnect.fr/enums/scenario_precarite#/$defs/8.4
        required:
          - scenario
      - properties:
          codeQuartierPrioritaire:
            title: Code du quartier prioritaire de la politique de la ville
            $ref: https://schemas.ceeconnect.fr/formats/code_quartier_prioritaire
          nomQuartierPrioritaire:
            title: Nom du quartier prioritaire de la politique de la ville
            type: string
            maxLength: 240
        required:
          - codeQuartierPrioritaire
          - nomQuartierPrioritaire
  '8.5':
    type: object
    allOf:
      - properties:
          scenario:
            $ref: https://schemas.ceeconnect.fr/enums/scenario_precarite#/$defs/8.5
        required:
          - scenario
      - properties:
          nombreMenages:
            title: Nombre de ménages
            description: Indiquer le nombre de ménages concernés par l'opération
            type: integer
            minimum: 1
          nombreMenagesModestes:
            title: Nombre de ménages modestes
            description: |
              Indiquer le nombre de ménages concernés par l'opération dont les ressources sont inférieures au plafond des 
              catégories "Modeste" et "Très modestes" du barème Ma Prime Rénov'
            type: integer
            minimum: 0
          nombreMenagesTresModestes:
            title: Nombre de ménages précaires
            description: |
              Indiquer le nombre de ménages concernés par l'opération dont les ressources sont inférieures au plafond de 
              catégorie "Très modestes" du barème Ma Prime Rénov'
            type: integer
            minimum: 0
          menages:
            title: Liste des ménages concernés par l'opération
            type: array
            minItems: 1
            items:
              $ref: '#/$defs/menage'
        required:
          - nombreMenages
          - nombreMenagesModestes
          - nombreMenagesTresModestes
          - menages
  menage:
    title: Ménage
    description: Ménage bénéficiant de l'opération d'économies d'énergie
    type: object
    properties:
      nom:
        $ref: https://schemas.ceeconnect.fr/formats/nom_famille
      prenom:
        $ref: https://schemas.ceeconnect.fr/formats/prenom
      composition:
        title: Composition
        description: Nombre de personnes composant le ménage
        type: integer
        minimum: 1
      categorieRessource:
        $ref: https://schemas.ceeconnect.fr/enums/categorie_ressource
      foyersFiscaux:
        title: Liste de foyers fiscaux
        description: Liste des foyers fiscaux composant le ménage
        type: array
        minItems: 1
        items:
          title: Foyer fiscal
          type: object
          properties:
            identifiantFiscal:
              $ref: https://schemas.ceeconnect.fr/formats/numero_fiscal
            referenceAvis:
              $ref: https://schemas.ceeconnect.fr/formats/reference_avis_imposition
          required:
            - identifiantFiscal
            - referenceAvis
    required:
      - nom
      - prenom
      - categorieRessource
      - foyersFiscaux
  bailleurSocial:
    title: Bailleur social
    type: object
    properties:
      nom:
        title: Nom du représentant
        $ref: https://schemas.ceeconnect.fr/formats/nom_famille
      prenom:
        title: Prénom du représentant
        $ref: https://schemas.ceeconnect.fr/formats/prenom
      fonction:
        title: Fonction du représentant
        $ref: https://schemas.ceeconnect.fr/formats/fonction
      raisonSociale:
        $ref: https://schemas.ceeconnect.fr/formats/raison_sociale
      siren:
        $ref: https://schemas.ceeconnect.fr/formats/siren
      adresse:
        $ref: https://schemas.ceeconnect.fr/mixins/adresse
      email:
        $ref: https://schemas.ceeconnect.fr/formats/email
      telephone:
        $ref: https://schemas.ceeconnect.fr/formats/telephone
      menages:
        title: Nombre de ménages couverts
        description: Nombre de ménages habitant un logement conventionné géré par l'organisme
        type: integer
        minimum: 0
    required:
      - nom
      - prenom
      - fonction
      - raisonSociale
      - siren
      - adresse
      - email
      - telephone
      - menages
examples:
  - scenario: "8.1"
    nom: NOM
    prenom: PRENOM
    composition: 3
    categorieRessource: MODESTE
    foyersFiscaux:
      - identifiantFiscal: "0000000000000"
        referenceAvis: "00000000000000"
